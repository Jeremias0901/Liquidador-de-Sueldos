<!DOCTYPE html>
<html lang="es">
<head>
    <script src="../view/resources/loadComponents.js"></script>
    <script src="js/index.js"></script>
    <title>Aguinaldo</title>
</head>
<body>
    <header></header>
    <nav></nav>

    <div class="contenedor">
        <div class="contenedor__aside" id="aside__left">
        </div>

        <div class="contenedor__contenido">
            <div class="semestres">
                <span>
                    <label class="semestres__button sombra" id="semestres__label-1sem" for="semestres__input-1sem">1era cuota</label>
                    <input id="semestres__input-1sem" name="semestre" type="radio" hidden />
                </span>
                <span>
                    <label class="semestres__button sombra" id="semestres__label-2sem" for="semestres__input-2sem">2da cuota</label>
                    <input id="semestres__input-2sem" name="semestre" type="radio" hidden />
                </span>
            </div>
            <div>
                <form class="semestres__formulario sombra contenedor3d" style="display: none;">
                    <span class="semestres__control">
                        <label class="semestres__label" for=""></label>
                        <input class="semestres__input" id="" placeholder="Sueldo Neto" type="number" required />
                    </span>
                    <span class="semestres__control">
                        <label class="semestres__label" for=""></label>
                        <input class="semestres__input" id="" placeholder="Sueldo Neto" type="number" required />
                    </span>
                    <span class="semestres__control">
                        <label class="semestres__label" for=""></label>
                        <input class="semestres__input" id="" placeholder="Sueldo Neto" type="number" required />
                    </span>
                    <span class="semestres__control">
                        <label class="semestres__label" for=""></label>
                        <input class="semestres__input" id="" placeholder="Sueldo Neto" type="number" required />
                    </span>
                    <span class="semestres__control">
                        <label class="semestres__label" for=""></label>
                        <input class="semestres__input" id="" placeholder="Sueldo Neto" type="number" required />
                    </span>
                    <span class="semestres__control">
                        <label class="semestres__label" for=""></label>
                        <input class="semestres__input" id="" placeholder="Sueldo Neto" type="number" required />
                    </span>
                </form>
            </div>
            <div class="resultado semestres__control sombra" style="display: none;">
                <label class="resultado__label" for="resultado__input"> Aguinaldo </label>
                <input class="resultado__input" id="resultado__input" readonly/>
            </div>
        </div>

        <div class="contenedor__aside" id="aside__right">
        </div>
    </div>

    <script>
        const loadForm = () => {
            const form = document.querySelector('.semestres__formulario');
            const inpSem1 = document.querySelector('#semestres__input-1sem');
            const loadSemestre = sem => {
                const semestresData = [
                    ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio'],
                    ['Julio', 'Agosto', 'Septiembre', 'Octubre', 'Nobiembre', 'Diciembre']
                ];
                const semestre = semestresData[sem];

                semestre.forEach((mes, i) => {
                    const [label] = form.children[i].getElementsByTagName('label');
                    label.innerHTML = mes;
                    label.setAttribute('for', mes);

                    const [input] = form.children[i].getElementsByTagName('input');
                    input.id = mes;
                })
            }

            form.style.display = 'flex';
            loadSemestre(inpSem1.checked ? 0 : 1);

            autoComplete()
            procesarAguinaldo()
        }

        document.querySelector('#semestres__input-1sem').addEventListener('click', loadForm)
        document.querySelector('#semestres__input-2sem').addEventListener('click', loadForm)

        const validate = () => {
            const expression = /^([1-9]{1}[0-9]{0,9})(\.[0-9]{1,2}|)$/;
            const ctrls = [...document.querySelector('.semestres__formulario').children];
            let validated = true;
            ctrls.forEach(span => {
                const [input] = span.getElementsByTagName('input');

                if(!expression.test(input.value)){
                    validated = false;
                    return;
                }
            })

            return validated;
        }


        const autoComplete = () => {
            const form = document.querySelector('.semestres__formulario');
            const min = 1, max = 9999999999;

            for (let i = 0; i < form.children.length; i++) {
                form.children[i].children[1].value = ((Math.random() * (max - min)) + min).toFixed(2);
            }
        }

        const inputs = [...document.querySelectorAll('.semestres__input')];

        const procesarAguinaldo = () => {
            if(validate()){
                document.querySelector('.resultado').style.display = 'flex';

                inputs.forEach(inp => inp.style.color = "black")
                const sueldos = inputs.map(inp => parseFloat(inp.value));
                document.querySelector('#resultado__input').value = calcular(sueldos);
            }
            else
                document.querySelector('.resultado').style.display = 'none';
        }

        inputs.forEach(input => input.addEventListener('keyup', procesarAguinaldo));
    </script>

    <footer></footer>
</body>
</html>
